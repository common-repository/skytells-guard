<? oxygen_import('Layouts.Header', array("title" => 'Vulnerabilities Scanner', 'page' => 'vulnerabilities')); ?>
        <div class="content">
            <div class="container-fluid">
<?php
/**
 * Admin: Plugin & Theme Exploits
 *
 * Unfortunately the WPScan API is only available to non-commercial
 * products. For Pro users of Skytells-AV, we'll have to settle for giving
 * them off-site links to the information rather than the results
 * themselves.
 *
 * @package Skytells-AV Security Scanner
 * @author  Skytells, Inc
 */

/**
 * Do not execute this file directly.
 */
if (!defined('ABSPATH')) {
	exit;
}

use \skytells\wp\skyav\ajax;
use \skytells\wp\skyav\core;
use \skytells\wp\skyav\vendor\common;

// And onto the data!
$data = array(
	'forms'=>array(
		'exploit'=>array(
			'action'=>'skyav_ajax_exploit_link',
			'n'=>ajax::get_nonce(),
			'slug'=>'',
			'type'=>'plugin',
			'errors'=>array(),
			'loading'=>false,
		),
	),
	'pro'=>true,
	'plugins'=>core::get_plugins(),
	'themes'=>core::get_themes(),
	'exploits'=>array(),
);
foreach (array('plugin', 'theme') as $field) {
	foreach ($data["{$field}s"] as $v) {
		$data['exploits']["{$field}-{$v['slug']}"] = array(
			'status'=>'pending',
			'link'=>'',
		);
	}
}


// JSON doesn't appreciate broken UTF.
common\ref\sanitize::utf8($data);
?>
<script>var skyavData=<?php echo json_encode($data, JSON_HEX_AMP); ?>;</script>
<div class="wrap" id="vue-exploits" v-cloak>
	<h1>Skytells-AV : <?php echo esc_html__('Plugin & Theme Vulnerabilities Pro', SKYELLSAV_L10N); ?></h1>

	<div class="notice notice-info" v-if="nextPending">
		<p><?php echo esc_html__('Vulnerability reference links are pulled for the plugins and themes installed on your site. Hold tight!', SKYELLSAV_L10N); ?></p>
	</div>

	<div id="poststuff">
		<div id="post-body" class="metabox-holder skyav-columns one-two fixed">

			<!-- Main Items -->
			<div class="postbox-container two">
				<!-- Plugins -->
				<div class="postbox">
					<h3 class="hndle"><?php echo esc_html__('Plugins', SKYELLSAV_L10N); ?></h3>
					<div class="inside">
						<table class="skyav-results">
							<thead>
								<tr>
									<th><?php echo esc_html__('Status', SKYELLSAV_L10N); ?></th>
									<th><?php echo esc_html__('Plugin', SKYELLSAV_L10N); ?></th>
								</tr>
							</thead>
							<tbody>
								<tr class="skyav-analysis" v-for="item in plugins" v-bind:class="{'is-pending' : exploits['plugin-' + item.slug].status === 'pending'}">
									<td>
										<span class="dashicons" v-bind:class="{
											'dashicons-yes' : exploits['plugin-' + item.slug].status === 'none',
											'dashicons-minus' : exploits['plugin-' + item.slug].status === 'closed',
											'dashicons-controls-pause' : exploits['plugin-' + item.slug].status === 'pending'
										}"></span>
									</td>
									<td>
										<div class="skyav-analysis--title">
											<span v-bind:class="{'skyav-fg-orange' : exploits['plugin-' + item.slug].status === 'active'}">
												{{ item.name }}
											</span>
											<span class="skyav-fg-grey">
												({{ item.version }})
											</span>
										</div>

										<div class="skyav-exploits">
											<div class="skyav-exploit" v-if="exploits['plugin-' + item.slug].link">
												<nav class="skyav-exploit--resources">
													<span class="skyav-exploit--label">External Resources:</span>

													<a v-bind:href="exploits['plugin-' + item.slug].link" target="_blank" rel="noopener">{{ exploits['plugin-' + item.slug].link }}</a>
												</nav>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<!-- Themes -->
				<div class="postbox">
					<h3 class="hndle"><?php echo esc_html__('Themes', SKYELLSAV_L10N); ?></h3>
					<div class="inside">
						<table class="skyav-results">
							<thead>
								<tr>
									<th><?php echo esc_html__('Status', SKYELLSAV_L10N); ?></th>
									<th><?php echo esc_html__('Theme', SKYELLSAV_L10N); ?></th>
								</tr>
							</thead>
							<tbody>
								<tr class="skyav-analysis" v-for="item in themes" v-bind:class="{'is-pending' : exploits['theme-' + item.slug].status === 'pending'}">
									<td>
										<span class="dashicons" v-bind:class="{
											'dashicons-yes' : exploits['theme-' + item.slug].status === 'none',
											'dashicons-minus' : exploits['theme-' + item.slug].status === 'closed',
											'dashicons-controls-pause' : exploits['theme-' + item.slug].status === 'pending'
										}"></span>
									</td>
									<td>
										<div class="skyav-analysis--title">
											<span v-bind:class="{'skyav-fg-orange' : exploits['theme-' + item.slug].status === 'active'}">
												{{ item.name }}
											</span>
											<span class="skyav-fg-grey">
												({{ item.version }})
											</span>
										</div>

										<div class="skyav-exploits">
											<div class="skyav-exploit" v-if="exploits['theme-' + item.slug].link">
												<nav class="skyav-exploit--resources">
													<span class="skyav-exploit--label">External Resources:</span>

													<a v-bind:href="exploits['theme-' + item.slug].link" target="_blank" rel="noopener">{{ exploits['theme-' + item.slug].link }}</a>
												</nav>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div><!--.postbox-container-->

			<!-- Sidebar -->
			<div class="postbox-container one">
				<div class="postbox">
					<h3 class="hndle"><?php echo esc_html__('WPScan Vulnerability Database', SKYELLSAV_L10N); ?></h3>
					<div class="inside">
						<?php
						$out = array(
							sprintf(
								esc_html__('The %s maintains a comprehensive history of exploitable coding errors discovered in WordPress themes and plugins.', SKYELLSAV_L10N),
								'<a href="https://wpvulndb.com/" target="_blank" rel="noopener">' . esc_html__('WPScan Vulnerability Database', SKYELLSAV_L10N) . '</a>'
							),
							esc_html__('In many cases, the threats are just that â€” historical. By keeping your software up-to-date, you are immune! Unless the history reveals a pattern of carelessness, you can probably ignore it.', SKYELLSAV_L10N),
							esc_html__('But if a plugin or theme has unfixed issues, it poses an active threat to your site. In such cases it is recommended you find an alternative and delete the original from your server.', SKYELLSAV_L10N),
						);

						echo '<p>' . implode('</p><p>', $out) . '</p>';
						?>
					</div>
				</div>
			</div><!--.postbox-container-->

		</div><!--#post-body-->
	</div><!--#poststuff-->

</div><!--.wrap-->


</div>
<? oxygen_import('Layouts.Footer'); ?>
